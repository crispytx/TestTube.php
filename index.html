<!DOCTYPE html>
<html>
<head>
<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'>
<style>
    #h1 {
        margin-top: 3em;
        text-align: center;
	font-family: Roboto;
	font-weight: 100;
	font-size: 4em;
    }
    #btn-wrapper {
        text-align: center;
    }
    .btn {
        font-family: Roboto;
	font-weight: 100;
        font-size: 2em;
	height: 2.5em;
	width: 13em;
	margin-right: -1px;
	margin-left: -1px;
    }
    #upload_form {
	visibility: hidden;
    }
    .movieClass {
        font-family: Roboto;
        font-weight: 100;
        font-size: 2em;
        text-align: center;
        color: black;
        text-decoration: none;
    }
</style>
</head>
<body>
<h1 id="h1">dangerous.php</h1>
<div id="mainContent">
<div id="btn-wrapper">
<button class="btn" id="left-btn" onclick="leftButtonFunction();">Watch Movies</button><button class="btn" id="right-btn" onclick="rightButtonFunction();">Upload Movies</button>
</div>
<br>
<br>
<center><progress id="progressBar" value="0" max="100" style="visibility: hidden;"></progress></center>
<br>
<form id="upload_form" enctype="multipart/form-data" method="post">
  <input type="file" name="file1" id="file1"><br>
  <input type="button" name="hiddenUploadBtn" id="hiddenUploadBtn" value="Upload File" onclick="uploadFile()"><br>
  <h3 id="status"></h3>
  <p id="loaded_n_total"></p>
</form>
</div>
<div id="movieContent">
</div>
<script>
      function _(el) {
    return document.getElementById(el);
  }
  function uploadFile() {
    var title = prompt("Please Enter a Title for This Movie");
    var file = _("file1").files[0];
    console.log("file name: " + file.name);
    console.log("file size: " + file.size);
    console.log("file type: " + file.type);
    var formdata = new FormData();
    formdata.append("file1", file);
    formdata.append("file2", title);
    var ajax = new XMLHttpRequest();
    ajax.upload.addEventListener("progress", progressHandler, false);
    ajax.addEventListener("load", completeHandler, false);
    ajax.addEventListener("error", errorHandler, false);
    ajax.addEventListener("abort", abortHandler, false);
    ajax.open("POST", "dangerous.php");
    ajax.send(formdata);
    document.getElementById('progressBar').style = "width: 65%; visibility: visible;";
  }

  function progressHandler(event) {
    _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
    var percent = (event.loaded / event.total) * 100;
    _("progressBar").value = Math.round(percent);
    _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
  }

  function completeHandler(event) {
    alert("Upload Complete :)");
    document.getElementById('progressBar').style = "visibility: hidden;";
  } 

  function errorHandler(event) {
    _("status").innerHTML = "Upload Failed";
  }

  function abortHandler(event) {
    _("status").innerHTML = "Upload Aborted";
  }
    var buttonClickStatus = false;
    function rightButtonFunction() {
        if (buttonClickStatus == false) {
            document.getElementById('left-btn').innerHTML = "Select File";
            document.getElementById('right-btn').innerHTML = "Upload File";
            buttonClickStatus = true;
        } else {
            document.getElementById('hiddenUploadBtn').click();
        }
    }
    function leftButtonFunction() {
        if (buttonClickStatus == true) {
            document.getElementById("file1").click();
        } else {
            // watch movies
            // AJAX -------------------------------------------------------------------------------------------
            var httpRequest = new XMLHttpRequest();
            var url = "dangerous-movies.php"
            httpRequest.open("GET", url, true);
            httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            httpRequest.onreadystatechange = function() {
                if (httpRequest.readyState == 4 && httpRequest.status == 200) {
                    var dataReturned = JSON.parse(httpRequest.responseText);
                    // Code to be executed upon AJAX call goes here
                    // For future reference, use the dataReturned object with dot notation 
                    // to access the data returned. For example: dataReturned.firstName, dataReturned.lastName
                    // where firstName and lastName are the "keys" from the returned JSON file
                    // DO STUFF HERE
                    // dataReturned.movies[0].title || dataReturned.movies[0].filename
                    var numberOfMovies = dataReturned.movies.length;
                    //alert(numberOfMovies);
                    document.getElementById('mainContent').innerHTML = ""; // remove everything but h1
                    for (i = 0; i < numberOfMovies && i < 100; i++) {
                        document.getElementById('movieContent').innerHTML += "<a class=\"movieClass\" href=\"" + dataReturned.movies[i].filename + "\"><p>" + dataReturned.movies[i].title + "</p></a>";
                    }
                }
            }
            httpRequest.send();
            // END AJAX CALL -----------------------------------------------------------------------------------
        } // end bracket for else statement;
    }// end bracket for leftButtonFunction()
</script>
</body>
</html>
